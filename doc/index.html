---
layout: default
---
<article>
<h1>Getting Started</h1>
<h2 id="installation">Installation</h2>

<p>
Fileshack can be hosted on your own server.
Fileshack is based on the web development framework
<a href="https://www.djangoproject.com">Django</a>.
In order to deploy fileshack on your server, you first need to have a working web
server such as <a href="https://nginx.org/">nginx</a>. For installation on nginx,
follow the sections <strong>Built-in server setup</strong> and then
<strong>nginx and gunicorn</strong>. The instructions assume that the operating
system is Linux or BSD.
<p>
In the instructions below, substitute
<var><em>/home/user/www/fs/</em></var> with your installation directory
and <var><em>fileshack.example.org</em></var> with the domain name of your server.
The domain name has to be correctly configured in the DNS to resolve to the
server's IP address.
</p>

<h4>Built-in server setup</h4>

<ol>
	<li>
		Install <strong>Python 3</strong> from you distribution package
		repositories. On APT:
		<div class="cmd">
			apt install python3
		</div>
	</li>
	<li>
		Create a new Python virtual environment (venv):
		<div class="cmd">
			mkdir -p <em>/home/user/www</em><br />
			cd <em>/home/user/www</em><br />
			python3 -m venv fs<br />
			cd fs<br />
			. bin/activate
		</div>
	</li>
	<li>
		Install django inside the virtual environment:
		<div class="cmd">
			pip3 install django
		</div>
	</li>
	<li>
		Clone the fileshackproject repository:
		<div class="cmd">
			git clone git://github.com/peterkuma/fileshackproject.git<br />
			cd fileshackproject<br />
		</div>
	</li>
	<li>
		Copy and customize the local settings example file:
		<div class="cmd">
			cp fileshackproject/settings_local-example.py fileshackproject/settings_local.py<br />
			vi fileshackproject/settings_local.py
		</div>
		Normally, you do not need to modify anything except for <var>ADMINS</var>,
		<var>SECRET_KEY</var>, and uncommenting
		<var>DEBUG = False</var> once your installation works properly.
	</li>
	<li>
		Initialize database:
		<div class="cmd">
			./manage.py migrate --run-syncdb<br />
			./manage.py createsuperuser
		</div>
		You will be asked to create a superuser account, by which you
		can later log in to the administration interface at
		<var>http://<em>fileshack.example.org</em>/admin/</var>.
		This command also creates a default store.
	</li>
	<li>
		Collect static files into the <var>static</var> directory:
		<div class="cmd">
			./manage.py collectstatic --noinput
		</div>
	</li>
	<li>
		At this point you can try to run fileshack with the integrated development server:
		<div class="cmd">
		    ./manage.py runserver<br />
		</div>
		The default store should be accessible at
		<a href="http://localhost:8000">http://localhost:8000</a>.
		If everything works fine, continue with setting up nginx.
	</li>
</ol>

<h4>nginx and gunicorn</h4>

This configuration below assumes installation on a Debian-derived Linux
distribution with systemd.

<ol>
	<li>
		Install <strong>nginx</strong> and <strong>gunicorn3</strong> from your
		distribution package repositories. On APT:
		<div class="cmd">
			apt install nginx gunicorn3
		</div>
	</li>
	<li>
		Add the domain on which you want to host the fileshack to
		<var>ALLOWED_HOSTS</var> in the configuration file
		<var>fileshackproject/settings_local.py</var>:
		<div class="cmd">
			ALLOWED_HOSTS = ['<em>fileshack.example.org</em>']
		</div>
	</li>
	<li>
		Create a new gunicorn systemd service
		<var>/etc/systemd/system/gunicorn-fileshack.service</var>:
		<div class="cmd">
			[Unit]<br />
			Description=gunicorn-fileshack<br />
			After=network.target<br />
			[Install]<br />
			WantedBy=multi-user.target<br />
			[Service]<br />
			User=<em>user</em><br />
			Group=<em>user</em><br />
			Restart=always<br />
			ExecStart=/usr/bin/gunicorn3 --workers=4 --log-file=<em>/home/user/www/fs/</em>gunicorn-fileshack.log --bind unix:<em>/home/user/www/fs/</em>fileshack.sock fileshackproject.wsgi<br />
			ExecReload=/bin/kill -s HUP $MAINPID<br />
			ExecStop=/bin/kill -s TERM $MAINPID<br />
			WorkingDirectory=<em>/home/user/www/fs/fileshackproject/</em><br />
			Environment=PYTHONPATH=<em>/home/user/www/fs/</em>lib/python3.<em>x</em>/site-packages<br />
			PrivateTmp=true
		</div>

		In the configuration above, change <em>user</em> to the user under which
		you want to run fileshack, and change <var>python3.x</var> to
		the version Python version installed on your system.

		Register and start the systemd service.

		<div class="cmd">
			systemctl enable gunicorn-fileshack<br />
			systemctl start gunicorn-fileshack
		</div>
	</li>
	<li>
		Create a new site in nginx configuration
		<var>/etc/nginx/sites-available/fileshack</var>:
		<div class="cmd">
			server {<br />
			&nbsp;&nbsp;&nbsp;&nbsp;listen 80;<br />
			&nbsp;&nbsp;&nbsp;&nbsp;listen [::]:80;<br />
			&nbsp;&nbsp;&nbsp;&nbsp;root <em>/home/user/www/fs/;</em><br />
			&nbsp;&nbsp;&nbsp;&nbsp;server_name <em>fileshack.example.org</em>;<br />
			&nbsp;&nbsp;&nbsp;&nbsp;client_max_body_size 0;<br />
			&nbsp;&nbsp;&nbsp;&nbsp;location / {<br />
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;proxy_pass http://unix:<em>/home/user/www/fs/</em>fileshack.sock;<br />
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;proxy_set_header Host $host;<br />
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;<br />
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;proxy_set_header X-Forwarded-Proto $scheme;<br />
			&nbsp;&nbsp;&nbsp;&nbsp;}<br />
			&nbsp;&nbsp;&nbsp;&nbsp;location /static/ {<br />
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;alias <em>/home/user/www/fs/</em>fileshackproject/static/;<br />
			&nbsp;&nbsp;&nbsp;&nbsp;}<br />
			&nbsp;&nbsp;&nbsp;&nbsp;location /media/ {<br />
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;alias <em>/home/user/www/fs/</em>fileshackproject/media/;<br />
			&nbsp;&nbsp;&nbsp;&nbsp;}<br />
			}
		</div>

		Create a symlink to the site configuration in nginx sites-enabled:
		<div class="cmd">
			ln -s /etc/nginx/sites-available/fileshack /etc/nginx/sites-enabled/
		</div>

		Test and reload nginx with:

		<div class="cmd">
			service nginx testconfig<br />
			service nginx reload
		</div>
	</li>
</ol>

<p>
Fileshack should now be accessible at
<var>http://<em>fileshack.example.org</em></var>. You can manage stores in the
administration interface at
<var>http://<em>fileshack.example.org</em>/admin/</var>. It is highly recommended
that you also set up an SSL certificate for the domain, such as with
<a href="https://letsencrypt.org/">Let's Encrypt</a>, and set up an access code
on the default store.
</p>

<p>
Do not forget to set <var>DEBUG = False</var> in <var>settings_local.py</var>
before going public. Otherwise, users are presented with ugly HTTP 404 and HTTP
500 pages, potentially revealing sensitive information.
</p>

<p>
If you encounter any problems, drop an e-mail to the mailing list at
<a href="mailto:fileshack-general@lists.sourceforge.net">fileshack-general@lists.sourceforge.net</a>.
</p>


<!--
<h4>Apache and mod_wsgi</h4>

<ol>
	<li>
		Install <strong>Apache 2</strong> and <strong>mod_wsgi (Python 3)</strong> from your
		distribution package repositories. On APT:
		<div class="cmd">
			apt install apache2 libapache2-mod-wsgi-py3
		</div>
	</li>
	<li>
		Make sure Apache has a permission to write to <var>db</var>,
		the database file <var>db/fileshack.sqlite</var> and <var>media</var>.
		<div class="cmd">
			chown www-data db db/fileshack.sqlite media
		</div>
		<p><var>media</var> is the directory where fileshack stores the uploaded files.
		If you like, you can make it a symlink to a different directory on the
		file system.</p>
	</li>
	<li>
		Create a new virtual host in the Apache configuration:
		<div class="code">
&lt;VirtualHost *:80&gt;<br />
&nbsp;&nbsp;&nbsp;ServerName <em>fileshack.example.org</em><br />
&nbsp;&nbsp;&nbsp;DocumentRoot <em>/home/user/www/fs/</em><br />
&nbsp;&nbsp;&nbsp;ErrorLog /var/log/apache2/fileshack_error.log<br />
&nbsp;&nbsp;&nbsp;CustomLog /var/log/apache2/fileshack_access.log common<br /><br />

&nbsp;&nbsp;&nbsp;&lt;Location /&gt;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Options -Indexes<br />
&nbsp;&nbsp;&nbsp;&lt;/Location&gt;<br /><br />

&nbsp;&nbsp;&nbsp;Alias /static/ <em>/home/user/www/fs</em>/fileshackproject/static/<br />
&nbsp;&nbsp;&nbsp;Alias /media/ <em>/home/user/www/fs</em>/fileshackproject/media/<br />
&nbsp;&nbsp;&nbsp;WSGIScriptAlias / <em>/home/user/www/fs</em>/fileshackproject/fileshackproject/wsgi_virtualenv.py<br />&lt;/VirtualHost&gt;
		</div>
		<div class="note">
			<var>wsgi_virtualenv.py</var> is the WSGI application for use with virtualenv. Use <var>wsgi.py</var>
			instead if you decide not to use virtualenv.
		</div>
	</li>
	<li>
		Test the configuration and restart apache:
		<div class="cmd">
			apache2ctl configtest<br />
			apache2ctl restart
		</div>
	</li>
</ol>

-->

<h3 id="store-watching">Store watching (optional)</h3>
<p>Fileshack allows users to opt in to receive e-mail notifications when
new files are uploaded. When enabled, a <strong>Watch</strong> button
is displayed next to the <strong>Logout</strong> button, allowing users
to enter an e-mail address to which to send notifications.
However, several more steps need to be taken in order to support
this feature.
</p>

<h5>Cron</h5>

<p>If you want your fileshack installation to support store watching,
you have to set up periodic requests to the service which
sends the notifications:</p>

<div class="code">
http://<em>fileshack.example.org</em>/cron/
</div>

<p>For security reasons, access to this URL is allowed only from hosts specified
in the configuration variable <var>FILESHACK_CRON_HOSTS</var>, or to those who
present with the shared secret <var>FILESHACK_CRON_SECRET</var>.</p>

<p>On Linux and other unix-like systems, periodic requests to a URL can be
accomplished by a scheduled command in the system daemon
<a href="https://www.debian.org/doc/manuals/debian-handbook/sect.task-scheduling-cron-atd.en.html">cron</a>.
In order to schedule such a request every 10 minutes,
create a file <var>/etc/cron.d/fileshack</var>:

<div class="code">
# Run scheduled tasks of the web application fileshack.<br />
#<br />
*/10	 * * * * <em>user</em> python3 -c 'import sys; import urllib.request; f=urllib.request.urlopen("http://<em>fileshack.example.org</em>/cron/", b"secret=<em>yoursecret</em>"); f.status==200 or sys.stdout.buffer.write(f.read())'
</div>

<p>Replace <em>user</em> with your username, and
<em>fileshack.example.org</em> with the correct
hostname of your fileshack installation.</p>

<p>If the hostname is not <strong>localhost</strong>,
you will have to set up a shared secret.
Replace <em>yoursecret</em> in the command above with your chosen
secret, and set <var>FILESHACK_CRON_SECRET</var> in
<var>fileshackproject/settings_local.py</var> to the same value.
</p>

<p>Alternatively, you can add the IP address of the cron machine to
<var>FILESHACK_CRON_HOSTS</var>. In this case, you do not have to
supply the shared secret. By default,
<var>FILESHACK_CRON_HOSTS</var> contains only <strong>localhost</strong>.</p>

<div class="note">If anything goes wrong with the cron command, you should
receive an e-mail with the command output on your user account from cron.
In any case, you can test by executing the python command above in the console.
Alternatively, the same can be accomplised more simply with:

<div class="code">
curl -d secret=<em>yoursecret</em> http://<em>fileshack.example.org</em>/cron/
</div>
</div>

<h5>Settings</h5>
<p>Store watching requires several configuration variables to be set up
properly — mail server settings EMAIL_*, FILESHACK_EMAIL_FROM and SECRET_KEY
in <var>fileshackproject/settings_local.py</var>.
Mail server settings are described in detail in the
<a href="https://docs.djangoproject.com/en/3.1/ref/settings/">django
documentation</a>.
</p>

<div class="note">
You have reload the gunicorn-fileshack service in order for the new settings to
be applied:
<div class="cmd">service gunicorn-fileshack restart</div>
</div>

<div class="note">If you do not set <var>SECRET_KEY</var>,
users will not be able to unsubscribe
via a link in notification messages. These links are protected
by HMAC, which requires a private secret.
</div>

<h5>Admin</h5>

<p>In <strong>Sites</strong>, modify the <strong>example.org</strong>
domain to reflect your domain setting.</p>

<p>Finally, you can enable <strong>Allow watch</strong>
in your chosen stores. To prevent bothering users
with copious amounts of messages, at most one notification is sent
per 6-hour period to a particular e-mail address.
This can be tuned by the <strong>Watch delay</strong>
option.</p>

<!--
<h3>Deployment on Google AppEngine</h3>

<div class="note">Deployment on Google AppEngine has not been tested recently
and may no longer work. Local deployment on nginx is recommended.</div>

<p>Google AppEngine is an application hosting service provided by Google.
The good thing about AppEngine is that your application is hosted for free
as long as you stay below rather high limits of bandwidth and storage
capacity. The bad thing is that it requires a special API to be used for
managing files, which prevents fileshack from running as efficiently as a
native installation, and some features such as downloading of unfinished
files are not supported. The demo on this site is hosted on Google AppEngine.</p>

<p>If you decided to deploy fileshack on Google AppEngine, follow these steps:</p>
<ol>
	<li>
		<a href="https://accounts.google.com/ServiceLogin?service=ah&amp;passive=true&amp;continue=https://appengine.google.com/_ah/conflogin%3Fcontinue%3Dhttps://appengine.google.com/&amp;ltmpl=ae">
		Create an Google account</a> (if you do not have any), and log in.
		Go to <a href="https://appengine.google.com/">Google AppEngine</a>
		and create a new application. Choose <strong>High Replication</strong>
		as the storage mode, and an <strong>Application Identifier</strong>
		of your preference.
	</li>
	<li>
		Prepare a clean working directory for the deployment:
		<div class="cmd">
			mkdir /home/user/fileshack<br />
			cd /home/user/fileshack
		</div>
	<li>
		Download <a href="https://developers.google.com/appengine/downloads#Google_App_Engine_SDK_for_Python">Google App Engine SDK for Python</a>
		and unpack it into the working directory. Add it the PATH environment
		variable:
		<div class="cmd">
			export PATH="$PATH:/home/user/fileshack/google_appengine"
		</div>
	</li>
	<li>
		Clone repositories from the django-nonrel project into the working directory:
		<div class="cmd">
			hg clone https://bitbucket.org/wkornewald/django-nonrel<br />
			hg clone https://bitbucket.org/wkornewald/djangoappengine<br />
			hg clone https://bitbucket.org/wkornewald/djangotoolbox<br />
			hg clone https://bitbucket.org/twanschik/django-autoload<br />
			hg clone https://bitbucket.org/wkornewald/django-dbindexer<br />
		</div>
		<div class="note">If you do not want to use <a href="https://www.mercurial-scm.org/">mercurial</a> (hg),
		you can download them from <a href="https://www.allbuttonspressed.com/projects/djangoappengine">allbuttonspressed.com</a>.</div>
	</li>
	<li>
		Clone the appengine branch of fileshack into the working directory:
		<div class="cmd">
			git clone -b appengine git://github.com/peterkuma/fileshackproject.git<br />
			cd fileshackproject
		</div>
	</li>
	<li>
		Open app.yaml and set <em>application:</em> to the <strong>Application Identifier</strong>
		you chose when you created the application on Google AppEngine.
		<div class="cmd">
			vi app.yaml
		</div>
	</li>
	<li>
		Copy and customize the local settings example file:
		<div class="cmd">
			cp fileshackproject/settings_local-example.py fileshackproject/settings_local.py<br />
			vi fileshackproject/settings_local.py
		</div>
		<p>Normally, you do not need to modify anything except for <var>ADMINS</var> and uncommenting
		<var>DEBUG = False</var> once your installation works properly.</p>
	</li>
	<li>
		Collect static files into the <var>static</var> directory:
		<div class="cmd">
			./manage.py collectstatic --noinput
		</div>
	</li>
	<li>
		Run server locally. Is everything OK?
		<div class="cmd">
			./manage.py runserver
		</div>
	</li>
	<li>
		Deploy! You will be asked for your Google Account login details
		in the process. The process will also create a new django
		superuser account (say yes when prompted).
		<div class="cmd">
			./manage.py deploy
		</div>
	</li>
	<li>
		Go to the django administration console at
		<var>http://<em>appidentifier</em>.appspot.com/admin/</var>,
		and log in with the superuser account. Create a new Store
		with an empty <em>Path</em>, empty <em>Media</em>,
		and <em>Access code</em> of your choice.
	</li>
	<li>
		Fileshack should now be accessible at <var>http://<em>appidentifier</em>.appspot.com</var>,
		and your Google administration console at <a href="https://appspot.com">https://appspot.com</a>.
		If you encounter any problems, drop an e-mail to the mailing list at
		<a href="mailto:fileshack-general@lists.sourceforge.net">fileshack-general@lists.sourceforge.net</a>.
	</li>
</ol>
-->

<h2 id="compatibility">Compatibility</h2>
<p>Fileshack is known to work with at least the following browsers:</p>
<ul>
	<li>Firefox 3.5 and newer</li>
	<li>Google Chrome</li>
	<li>Opera</li>
	<li>Safari 5 on Windows and Snow Leopard</li>
	<li>Internet Explorer 7, 8, 9</li>
</ul>
<p>Drag &amp; Drop and progress indication are not supported in all browsers.</p>

<h2 id="releasenotes">Release Notes</h2>
<div class="releasenotes">
	<h4>Fileshack 1.0.1<span class="date">(4 August 2021)</span></h4>
	<ul>
		<li>Various fixes required to run on modern browsers and with
		nginx/gunicorn.</li>
	</ul>
	<h4>Fileshack 1.0<span class="date">(3 August 2021)</span></h4>
	<ul>
		<li>Migration to Python 3 and Django 3.1.</li>
	</ul>
	<h4>Fileshack 0.9<span class="date">(25 June 2012)</span></h4>
	<ul>
	    <li>Files are not read into memory in full,
	    but uploaded by File.slice() if available.
	    This greatly reduces memory footprint and improves performance
	    when uploading large files.</li>
		<li>It is now possible to upload multiple files at once.</li>
		<li>Fixed handling of unicode characters in file names.</li>
		<li>Sessions now last until the browser is closed.</li>
		<li>Fixed error message in Opera on expired session.</li>
	</ul>
	<h4>Fileshack 0.8<span class="date">(27 April 2012)</span></h4>
	<ul>
		<li>Store watching.</li>
		<li>Fixed HTTP 404 page.</li>
		<li>Logout is now protected against CSRF.</li>
		<li>Django 1.4 timezone support.</li>
	</ul>
	<h4>Fileshack 0.7<span class="date">(18 April 2012)</span></h4>
	<ul>
		<li>Fixed uploading to custom (non-default) stores.</li>
		<li>Fixed enforcement of store size limit.</li>
		<li>Fixed error dialog placement.</li>
		<li>Improved uploading in IE. Items are now replaced in-place without
		    a refresh, and errors are reported in the usual way via an error
		    dialog.</li>
		<li>Open stores with an empty access code are now allowed.</li>
	</ul>
	<h4>Fileshack 0.6<span class="date">(29 March 2012)</span></h4>
	<ul>
		<li>Fixed uploading in Safari 5 on Snow Leopard.</li>
		<li>Fixed regression in IE and Firefox 3.5.</li>
		<li>Tweaked style to better support small screens.</li>
	</ul>
	<h4>Fileshack 0.5<span class="date">(28 March 2012)</span></h4>
	<ul>
		<li>Fixed uploading in Firefox 3.5.</li>
		<li>Fixed style in some legacy browsers.</li>
	</ul>
	<h4>Fileshack 0.4<span class="date">(27 March 2012)</span></h4>
	<ul>
		<li>Fixed upload indication in IE 8 and 9.</li>
		<li>Fixed dropbox text in IE 7.</li>
		<li>Fixed delete in IE 7 and 8.</li>
	</ul>
	<h4>Fileshack 0.3<span class="date">(26 March 2012)</span></h4>
	<ul>
		<li>Fixed upload by Drag &amp; Drop in Safari.</li>
		<li>Fixed dropbox text when Drag &amp; Drop is not supported.</li>
	</ul>
	<h4>Fileshack 0.2<span class="date">(25 March 2012)</span></h4>
	<ul>
		<li>Support for Safari and IE6-9.</li>
	</ul>
	<h4>Fileshack 0.1<span class="date">(20 March 2012)</span></h4>
	<ul>
		<li>Initial release.</li>
	</ul>
</div>

<h2 id="howdoesitwork">How does it work?</h2>
<p>Fileshack uses one of the following methods of uploading a file,
listed from the most sophisticated to the least sophisticated:
<ol>
	<li>
		<strong>XMLHttpRequest with File API.</strong> File is read into browser
		memory by FileReader and uploaded by chunks. During upload, chunk size
		is tuned so that an optimal upload time is achieved. If upload fails,
		it can be resumed by starting from the last uploaded chunk. File
		upload progress is show.
		This method is supported by Firefox, Google Chrome and Opera.
		However, as Opera does not support XMLHttpRequest.upload,
		upload progress is coarse (by chunks).
	</li>
	<li>
		<strong>XMLHttpRequest with FormData.</strong> File is upload
		in full by XMLHttpRequest.send(FormData). Resume of a failed
		upload is not supported. Upload progress is indicated.
		This method is chosen for browers not supporting File API, such
		as Safari.
	</li>
	<li>
		<strong>Submitting a hidden iframe.</strong> This is a trick
		allowing submitting a file without displaying a file input element.
		Click on the dropbox is delegated to a file input element inside
		a hidden iframe, in order to circumvent a security check in IE not
		allowing to submit a form when a click was delegated.
		No progress indication is supported.
		This method is supported by browsers such as IE8 and IE9.
	</li>
	<li>
		<strong>Explicit file input element.</strong>
		An input element is displayed inside the dropbox.
		This method is chosen for browsers such as IE7.
	</li>
</ol>

<h2 id="contributing">Contributing</h2>
You can contribute by <a href="https://github.com/peterkuma/fileshackproject/issues">reporting issues</a>,
forking or joining the project as a developer on github. Thank you!
</article>
